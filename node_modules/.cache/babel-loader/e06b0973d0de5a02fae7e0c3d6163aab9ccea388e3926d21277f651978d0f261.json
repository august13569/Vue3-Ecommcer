{"ast":null,"code":"import CouponModal from '@/components/CouponModal.vue';\nimport DeleteModal from '@/components/DeleteModal.vue';\nimport ToastMessages from '@/components/ToastMessages.vue';\nexport default {\n  components: {\n    CouponModal,\n    DeleteModal,\n    ToastMessages\n  },\n  props: {\n    config: Object\n  },\n  data() {\n    return {\n      coupons: {},\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        code: ''\n      },\n      delItemId: '',\n      isLoading: false,\n      isNew: false\n    };\n  },\n  methods: {\n    openCouponModal(isNew, item) {\n      this.isNew = isNew;\n      if (this.isNew) {\n        this.tempCoupon = {\n          due_date: new Date().getTime() / 1000\n        };\n      } else {\n        this.tempCoupon = {\n          ...item\n        };\n      }\n      this.$refs.couponModal.showModal();\n    },\n    openDelCouponModal(item) {\n      this.tempCoupon = {\n        ...item\n      };\n      const delComponent = this.$refs.delModal;\n      delComponent.showModal();\n    },\n    getCoupons() {\n      this.isLoading = true;\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`;\n      this.$http.get(url, this.tempProduct).then(res => {\n        this.coupons = res.data.coupons;\n        this.isLoading = false;\n      }).catch(err => {\n        this.$emitter.emit('push-message', {\n          style: 'danger',\n          title: 'Something went wrong, please try again.'\n        });\n      });\n    },\n    updateCoupon(tempCoupon) {\n      if (this.isNew) {\n        const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n        this.$http.post(url, {\n          data: tempCoupon\n        }).then(res => {\n          this.getCoupons();\n          this.$emitter.emit('push-message', {\n            style: 'primary',\n            title: 'The coupon has been added'\n          });\n          this.$refs.couponModal.hideModal();\n        }).catch(err => {\n          this.$emitter.emit('push-message', {\n            style: 'danger',\n            title: 'Something went wrong, please try again.'\n          });\n        });\n      } else {\n        const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`;\n        this.$http.put(url, {\n          data: this.tempCoupon\n        }).then(res => {\n          this.getCoupons();\n          this.$emitter.emit('push-message', {\n            style: 'primary',\n            title: 'The coupon has been updated'\n          });\n          this.$refs.couponModal.hideModal();\n        }).catch(err => {\n          this.$emitter.emit('push-message', {\n            style: 'danger',\n            title: 'Something went wrong, please try again.'\n          });\n        });\n      }\n    },\n    deletCoupon() {\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.delItemId}`;\n      this.isLoading = true;\n      this.$http.delete(url).then(res => {\n        this.getCoupons();\n        this.$emitter.emit('push-message', {\n          style: 'primary',\n          title: 'The coupon has been removed.'\n        });\n      }).catch(err => {\n        this.$emitter.emit('push-message', {\n          style: 'danger',\n          title: 'Something went wrong, please try again.'\n        });\n      });\n    }\n  },\n  created() {\n    this.getCoupons();\n  }\n};","map":{"version":3,"names":["CouponModal","DeleteModal","ToastMessages","components","props","config","Object","data","coupons","tempCoupon","title","is_enabled","percent","code","delItemId","isLoading","isNew","methods","openCouponModal","item","due_date","Date","getTime","$refs","couponModal","showModal","openDelCouponModal","delComponent","delModal","getCoupons","url","process","env","VUE_APP_API","VUE_APP_PATH","$http","get","tempProduct","then","res","catch","err","$emitter","emit","style","updateCoupon","post","hideModal","id","put","deletCoupon","delete","created"],"sources":["C:\\Users\\augus\\OneDrive\\桌面\\暫存區\\vue-practice\\brite\\src\\views\\back\\Coupons.vue"],"sourcesContent":["<template>\n  <Loading :active=\"isLoading\"></Loading>\n  <ToastMessages />\n  <DeleteModal @delete-item=\"deletCoupon\"></DeleteModal>\n  <div>\n    <Loading :active=\"isLoading\"></Loading>\n    <div class=\"text-end mt-4\">\n      <button class=\"btn btn-primary text-white\" type=\"button\" @click=\"openCouponModal(true)\">\n        建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n      <tr>\n        <th>名稱</th>\n        <th>折扣百分比</th>\n        <th>到期日</th>\n        <th>是否啟用</th>\n        <th>編輯</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr v-for=\"(item, key) in coupons\" :key=\"key\">\n        <td>{{ item.title }}</td>\n        <td>{{ item.percent }}%</td>\n        <td>{{ $filters.date(item.due_date) }}</td>\n        <td>\n          <span v-if=\"item.is_enabled === 1\" class=\"text-success\">啟用</span>\n          <span v-else class=\"text-muted\">未起用</span>\n        </td>\n        <td>\n          <div class=\"btn-group\">\n            <button class=\"btn btn-outline-primary btn-sm\"\n                    type=\"button\"\n                    @click=\"openCouponModal(false, item)\"\n            >編輯</button>\n            <button class=\"btn btn-outline-danger btn-sm\"\n                    type=\"button\"\n                    data-bs-toggle=\"modal\"\n                    data-bs-target=\"#deleteModal\"\n                    @click=\"this.delItemId = item.id\"\n            >刪除</button>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n    <CouponModal :coupon=\"tempCoupon\" ref=\"couponModal\" @update-coupon=\"updateCoupon\"/>\n  </div>\n</template>\n\n<script>\nimport CouponModal from '@/components/CouponModal.vue';\nimport DeleteModal from '@/components/DeleteModal.vue';\nimport ToastMessages from '@/components/ToastMessages.vue';\n\nexport default {\n  components: {\n    CouponModal,\n    DeleteModal,\n    ToastMessages,\n  },\n  props: {\n    config: Object,\n  },\n  data() {\n    return {\n      coupons: {},\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        code: '',\n      },\n      delItemId: '',\n      isLoading: false,\n      isNew: false,\n    };\n  },\n  methods: {\n    openCouponModal(isNew, item) {\n      this.isNew = isNew;\n      if (this.isNew) {\n        this.tempCoupon = {\n          due_date: new Date().getTime() / 1000,\n        };\n      } else {\n        this.tempCoupon = { ...item };\n      }\n      this.$refs.couponModal.showModal();\n    },\n    openDelCouponModal(item) {\n      this.tempCoupon = { ...item };\n      const delComponent = this.$refs.delModal;\n      delComponent.showModal();\n    },\n    getCoupons() {\n      this.isLoading = true;\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`;\n      this.$http.get(url, this.tempProduct)\n        .then((res) => {\n          this.coupons = res.data.coupons;\n          this.isLoading = false;\n        })\n        .catch((err) => {\n          this.$emitter.emit('push-message', {\n            style: 'danger',\n            title: 'Something went wrong, please try again.',\n          });\n        });\n    },\n    updateCoupon(tempCoupon) {\n      if (this.isNew) {\n        const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n        this.$http.post(url, { data: tempCoupon })\n          .then((res) => {\n            this.getCoupons();\n            this.$emitter.emit('push-message', {\n              style: 'primary',\n              title: 'The coupon has been added',\n            });\n            this.$refs.couponModal.hideModal();\n          })\n          .catch((err) => {\n            this.$emitter.emit('push-message', {\n              style: 'danger',\n              title: 'Something went wrong, please try again.',\n            });\n          });\n      } else {\n        const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`;\n        this.$http.put(url, { data: this.tempCoupon })\n          .then((res) => {\n            this.getCoupons();\n            this.$emitter.emit('push-message', {\n              style: 'primary',\n              title: 'The coupon has been updated',\n            });\n            this.$refs.couponModal.hideModal();\n          })\n          .catch((err) => {\n            this.$emitter.emit('push-message', {\n              style: 'danger',\n              title: 'Something went wrong, please try again.',\n            });\n          });\n      }\n    },\n    deletCoupon() {\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.delItemId}`;\n      this.isLoading = true;\n      this.$http.delete(url)\n        .then((res) => {\n          this.getCoupons();\n          this.$emitter.emit('push-message', {\n            style: 'primary',\n            title: 'The coupon has been removed.',\n          });\n        })\n        .catch((err) => {\n            this.$emitter.emit('push-message', {\n              style: 'danger',\n              title: 'Something went wrong, please try again.',\n            });\n        });\n    },\n  },\n  created() {\n    this.getCoupons();\n  },\n};\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}